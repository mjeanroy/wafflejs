!function(t,e,n){!function(e){"function"==typeof define&&define.amd?define(["react"],e):"object"==typeof exports?module.exports=e(require("react")):t.Waffle=e(React)}(function(r){"use strict";var i=function(){var e=function(n){return n instanceof e?n:this instanceof e?(n===t?n=[t]:o.isElement(n)&&(n=[n]),o.forEach(n,function(t,e){this[e]=t},this),this.length=n.length,void(this.$$events=[])):new e(n)},n=function(t,e,n,r){r.addEventListener(e,n),t.$$events.push({event:e,callback:n,node:r})},r=function(t,e,n,r){r.removeEventListener(e,n)},i=function(t,e){return o.forEach(t,e,t),t};return e.prototype={children:function(){var t=[];return i(this,function(e){o.forEach(e.childNodes,function(e){1===e.nodeType&&t.push(e)})}),new e(t)},eq:function(t){return new e(this[t])},on:function(t,e){for(var r=t.indexOf(" ")>=0?t.split(" "):[t],i=0,o=r.length;o>i;++i)for(var s=0,a=this.length;a>s;++s)n(this,r[i],e,this[s]);return this},off:function(t,e){for(var n=t?t.indexOf(" ")>=0?t.split(" "):[t]:[],i=n.length,o=[],s=0,a=this.$$events.length;a>s;++s){for(var u=this.$$events[s],c=0===i,h=0;i>h;++h){var l=n[h];if(!(l&&u.event!==l||e&&u.callback!==e)){c=!0;break}}c?r(this,u.event,u.callback,u.node):o.push(u)}this.$$events=o},empty:function(){return i(this,function(t){for(;t.firstChild;)t.removeChild(t.firstChild)})},append:function(t){return i(this,function(e,n,r){var i=n===r.length-1?t:t.cloneNode(!0);e.appendChild(i)})},prepend:function(t){return i(this,function(e,n,r){var i=n===r.length-1?t:t.cloneNode(!0);e.insertBefore(i,e.childNodes[0])})},after:function(t){return i(this,function(e,n,r){var i=n===r.length-1?t:t.cloneNode(!0);e.parentNode.insertBefore(i,e.nextSibling)})},css:function(t,e){var n,r;return o.isObject(t)?(n=t,r=o.keys(n)):(n={},n[t]=e,r=[t]),i(this,function(t){o.forEach(r,function(e){t.style[e]=n[e]})})},addClass:function(t){return i(this,function(e){var n=e.className;e.className=(n?n+" ":"")+t})},removeClass:function(t){var e=t.split(" "),n=o.indexBy(e,function(t){return t});return i(this,function(t){var e=t.className,r=o.filter(e.split(" "),function(t){return!n[t]});t.className=r.join(" ")})},attr:function(t,e){var n,r=t;return 2===arguments.length?(r={},r[t]=e,n=[t]):n=o.keys(r),i(this,function(t){o.forEach(n,function(e){t.setAttribute(e,r[e])})})},removeAttr:function(t){return i(this,function(e){e.removeAttribute(t)})}},e}(),o=function(){var t=Array.prototype,e=t.slice,r=Object.prototype,i=Object.keys,o=r.hasOwnProperty,s=r.toString,a=Function.prototype.bind,u=function(t){return h.isString(t)?function(e){return e[t]}:t},c=function(t){return function(e,n,r){for(var i={},o=u(n),s=0,a=e.length;a>s;++s){var c=o.call(r,e[s],s,e);t(i,e[s],c)}return i}},h={};h.isNull=function(t){return null===t},h.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"===s.call(t)},h.bind=function(t,e){return a?t.bind(e):function(){return t.apply(e,arguments)}},h.constant=function(t){return function(){return t}},h.toArray=function(t){return h.map(t,function(t){return t})},h.isNaN=function(t){return h.isNumber(t)&&t!==+t},h.once=function(t){var e,n=!1;return function(){return n||(n=!0,e=t.apply(this,arguments),t=null),e}},h.defaults=function(t,e){return h.forEach(h.keys(e),function(n){h.isUndefined(t[n])&&(t[n]=e[n])}),t},h.result=function(t,e){var n=t[e];return h.isFunction(n)?n.call(t):n},h.has=function(t,e){return o.call(t,e)},h.size=function(t){return null==t?0:t.length},h.first=function(t,n){return null==n?t[0]:e.call(t,0,n)},h.last=function(t,n){return null==n?t[t.length-1]:e.call(t,t.length-n,t.length)},h.rest=function(t,n){var r=arguments.length>1?n:1;return e.call(t,r,t.length)},h.initial=function(t,n){var r=t.length,i=arguments.length>1?r-n:r-1;return e.call(t,0,i)},h.indexOf=function(t,e){for(var n=0,r=t.length;r>n;++n)if(t[n]===e)return n;return-1},h.lastIndexOf=function(t,e){for(var n=t.length-1;n>=0;--n)if(t[n]===e)return n;return-1},h.contains=function(t,e){return h.indexOf(t,e)>=0},h.keys=function(t){if(!h.isObject(t))return[];if(i)return i(t);var e=[];for(var n in t)h.has(t,n)&&e.push(n);return e},h.functions=function(t){var e=[];for(var n in t)h.isFunction(t[n])&&e.push(n);return e.sort()},h.map=function(t,e,n){for(var r=[],i=0,o=t.length;o>i;++i)r[i]=e.call(n,t[i],i,t);return r},h.every=function(t,e,n){for(var r=0,i=t.length;i>r;++r)if(!e.call(n,t[r],r,t))return!1;return!0},h.some=function(t,e,n){for(var r=0,i=t.length;i>r;++r)if(e.call(n,t[r],r,t))return!0;return!1},h.filter=function(t,e,n){for(var r=[],i=0,o=t.length;o>i;++i)e.call(n,t[i],i,t)&&r.push(t[i]);return r},h.reject=function(t,e,n){for(var r=[],i=0,o=t.length;o>i;++i)e.call(n,t[i],i,t)||r.push(t[i]);return r},h.reduce=function(t,e,n,r){for(var i=arguments.length,o=i>=3?n:t[0],s=t.length,a=i>=3?0:1;s>a;++a)o=e.call(r,o,t[a],a,t);return o},h.reduceRight=function(t,e,n,r){for(var i=arguments.length,o=t.length-1,s=i>=3?n:t[o],a=i>=3?o:o-1;a>=0;--a)s=e.call(r,s,t[a],a,t);return s},h.find=function(t,e,r){for(var i=0,o=t.length;o>i;++i)if(e.call(r,t[i],i,t))return t[i];return n},h.partition=function(t,e){for(var n=[],r=[],i=0,o=t.length;o>i;++i)e.call(null,t[i],i,t)?n.push(t[i]):r.push(t[i]);return[n,r]},h.memoize=function(t,e){var n=function(r){var i=n.cache,o=e?e.apply(this,arguments):r;return h.has(i,o)||(i[o]=t.apply(this,arguments)),i[o]};return n.cache={},n},h.debounce=function(t,e,n){var r;return function(){var i=this,o=arguments,s=function(){r=null,n||t.apply(i,o)},a=n&&!r;r&&(clearTimeout(r),r=null),r=setTimeout(s,e),a&&t.apply(i,o)}},h.wrap=function(t,e){return function(){var n=h.toArray(arguments),r=[t].concat(n);return e.apply(this,r)}},h.now=Date.now||function(){return(new Date).getTime()};var l=0;return h.uniqueId=function(t){var e=++l+"";return t?t+e:e},h.indexBy=c(function(t,e,n){t[n]=e}),h.groupBy=c(function(t,e,n){(t[n]=t[n]||[]).push(e)}),h.countBy=c(function(t,e,n){t[n]=(t[n]||0)+1}),h}();!function(){var t=Object.prototype.toString;o.noop=function(){},o.identity=function(t){return t},o.isUndefined=function(t){return"undefined"==typeof t},o.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},o.isElement=function(t){return!(!t||1!==t.nodeType)},o.clone=function(t){return o.isArray(t)?o.map(t,o.identity):o.extend({},t)},o.forEach=function(t,e,n){for(var r=0,i=t.length;i>r;++r)e.call(n,t[r],r,t)},o.extend=function(t,e){for(var n in e)o.has(e,n)&&(t[n]=e[n]);return t},o.forEach(["String","Function","Number","Date","Array"],function(e){o["is"+e]=function(n){return t.call(n)==="[object "+e+"]"}}),Array.isArray&&(o.isArray=Array.isArray)}();var s=function(){var t=function(t){return function(e){if(!JSON||!JSON[t])throw Error("JSON."+t+" is not available in your browser");return JSON[t](e)}};return{toJson:t("stringify"),fromJson:t("parse")}}(),a=function(){var t="key_",e=function(e){return t+e},n=function(){this.$o={}};return n.prototype={clear:function(){this.$o={}},put:function(t,n){return this.$o[e(t)]=n,this},get:function(t){return this.$o[e(t)]},remove:function(t){return delete this.$o[e(t)],this},contains:function(t){return o.has(this.$o,e(t))}},n}(),u=function(){var t=new a,n={input:"input"};return{hasEvent:function(r){if("input"===r&&e.documentMode<=11)return!1;if(!t.contains(r)){var i=e.createElement(n[r]||"div"),o="on"+r in i;t.put(r,!!o),i=null}return t.get(r)}}}(),c=function(){var t=function(t,e){this.value=t,this.next=e||null},e=function(){this.root=null};return e.prototype={push:function(e){this.root=new t(e,this.root)},peek:function(){return this.root?this.root.value:n},pop:function(){var t;return this.root&&(t=this.root.value,this.root=this.root.next),t},isEmpty:function(){return!this.root}},e}(),h=function(){var t=new a,e=function(t){throw Error("Malformed expression: "+t||"unexpected end of input")},r=function(t,e){return e+t},i=function(t){return function(n,r,i,o){o.pop()!==t&&e()}},s="",u=".",h="[",l="(",f="]",d=")",v='"',p="'",g=" ",b={};b[u]=function(t,e,n){return n.push(e),s},b[h]=function(t,e,n,r){return r.push(t),b[u].apply(this,arguments)},b[l]=function(t,e,n,r){r.push(t)},b[v]=function(t,n,r,i){switch(i.peek()){case t:i.pop();break;case h:i.push(t);break;default:e()}},b[g]=function(t,e,n,r){var i=r.peek();return i!==l&&i!==h?e+t:void 0},b[p]=b[v],b[f]=i(h),b[d]=i(l);var m=function(t){for(var n=[],i=new c,s="",a=0,u=t.length;u>a;++a){var h=t.charAt(a),l=b[h]||r,f=l(h,s,n,i);o.isString(f)&&(s=f)}return i.isEmpty()&&s||e(),n.push(s),n},$=function(t){return null==t?{}:t},y=function(t,e){for(var r=t.length,i=e,s=0;r>s;++s){if(null==i||!o.isObject(i))return n;i=o.result(i,t[s])}return i},x=function(t,e,n){for(var r=t.length-1,i=e,s=i,a=0;r>a;++a)s=o.result(i,t[a]),s=i[t[a]]=$(s);return s[o.last(t)]=n,n};return function(e){if(!t.contains(e)){var n=m(e),r=function(t){return y(n,t)};r.assign=function(t,e){return x(n,t,e)},t.put(e,r)}return t.get(e)}}(),l=function(t){var n=e.createElement("div");return n.appendChild(e.createTextNode(t)),n.innerHTML},f="waffle-",d=f+"grid",v=f+"sortable",p=v+"-asc",g=v+"-desc",b=f+"draggable",m=b+"-drag",$=b+"-over",y=f+"fixedheader",x=f+"selectable",C=f+"selected",w=f+"checkbox",k="data-waffle-",E=k+"cid",N=k+"id",S=k+"sortable",A=k+"order",D=k+"idx",T="+",O="-",F="tbody",z="thead",j="tfoot",R="table",B={msie:function(){return e.documentMode},endWith:function(t,e){return!!t&&t.slice(t.length-e.length)===e},isPx:function(t){return B.endWith(t,"px")},isPercentage:function(t){return B.endWith(t,"%")},fromPercentage:function(t){return o.isString(t)?Number(t.replace("%","")):t},toPx:function(t){return o.isNumber(t)?t+"px":t},fromPx:function(t){return o.isString(t)?Number(t.replace("px","")):t},capitalize:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},resultWith:function(t,e,n){return o.isFunction(t)?t.apply(e,n):t},split:function(t,e){for(var n=e||20,r=[],i=[],o=0,s=t.length;s>o;++o)i.push(t[o]),i.length===n&&(r.push(i),i=[]);return i.length>0&&r.push(i),r},parse:function(t){try{return s.fromJson(t)}catch(e){if("false"===t)return!1;if("true"===t)return!0;var n=Number(t);return o.isNaN(n)?t:n}},destroy:function(t){for(var e in t)o.has(t,e)&&(t[e]=null)},toSpinalCase:function(t){for(var e="",n=0,r=t.length;r>n;++n){var i=t.charAt(n);e+=i.toLowerCase()===i?i:"-"+i.toLowerCase()}return e},asyncTask:function(t,e,n,r){var i=0,o=function(){if(t.length>0){var s=t.shift();n(s,i),i+=s.length,t.length>0?setTimeout(o,e):(r(),o=null)}};setTimeout(o)}},W=function(){var t=function(){var t=e.createElement("div");t.style.width="100px",t.style.height="100px",t.style.overflow="scroll",t.style.position="absolute",t.style.top="-9999px",e.body.appendChild(t);var n=t.offsetWidth-t.clientWidth;return e.body.removeChild(t),n},n=function(){return"body"},r=function(t,e){var n=e.type;n&&(t.type=n),o.forEach(o.keys(e),function(n){var r=e[n];switch(n){case"className":case"checked":case"indeterminate":case"value":t[n]=r;break;case"style":o.extend(t.style,r);break;default:t.setAttribute(n,r)}})},i=function(t,e){o.isString(e)?t.innerHTML=e:o.isArray(e)?o.forEach(e,function(e){t.appendChild(e)}):t.appendChild(e)},s={create:function(t,n,o){var s=e.createElement(t);return n&&r(s,n),o&&i(s,o),s},byId:function(t){var n=e.getElementById(t);return n?[n]:[]},byTagName:function(t,n){return(n||e).getElementsByTagName(t)},createFragment:function(){return e.createDocumentFragment()},findParent:function(t,e){for(;t&&t.tagName!==e;)t=t.parentNode;return t},scrollbarWidth:o.memoize(t,n)};return o.forEach(["tr","td","th",F,z,j,"input","select","option","span"],function(t){s[t]=function(e,n){return this.create.call(this,t,e,n)}}),o.forEach(["text","checkbox","number","email","url","date","time","datetime"],function(t){s["input"+B.capitalize(t)]=function(e,n){var r=o.extend({type:t},e||{});return this.input.call(this,r,n)}}),s}(),I=function(){var t=function(t,e,n){return t.replaceChild(n,e)},e=function(t,e){t.nodeValue!==e.nodeValue&&(t.nodeValue=e.nodeValue)},n=function(t,e){for(;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)},r=function(t,e){i.mergeAttributes(t,e);var r=t.childNodes,o=e.childNodes;if(r.length!==o.length)n(t,e);else for(var s=0,a=r.length;a>s;++s)i.mergeNodes(t,r[s],o[s])},i={mergeNodes:function(n,i,o){var s=i.nodeType,a=o.nodeType,u=i.tagName,c=o.tagName,h=i;return s!==a||u!==c?(t(n,i,o),h=o):3===s?e(i,o):r(i,o),h},mergeAttributes:function(t,e){var n=o.indexBy(t.attributes,"name"),r=o.indexBy(e.attributes,"name");o.forEach(o.keys(r),function(e){var i=n[e]||null,o=i?i.value:null,s=r[e].value;o!==s&&t.setAttribute(e,s),i&&delete n[e]}),o.forEach(o.keys(n),function(e){t.removeAttribute(e)})}};return i}(),P=function(){var t=o.noop,e=function(t,e,n){this.type=t,this.bubbles=!1,this.cancelable=!1,this.details=n,this.timeStamp=o.now(),this.target=e,this.currentTarget=e,this.srcElement=e};return e.prototype={preventDefault:t,stopPropagation:t,stopImmediatePropagation:t},e}(),L=function(){var t=function(t){return t.toLowerCase()},e=function(){this.$events={}};return e.prototype={addEventListener:function(e,n){var r=t(e),i=this.$events,o=i[r]=i[r]||[];o.push(n)},removeEventListener:function(e,n){var r=t(e),i=this.$events[r];i&&i.length&&(this.$events[r]=o.reject(i,function(t){return t===n}))},dispatchEvent:function(e,n,r){n=t(n);var i=this.$events[n];if(i&&i.length)for(var s=new P(n,e,o.isFunction(r)?r.call(e):r),a=0,u=i.length;u>a;++a)try{i[a].call(e,s)}catch(c){}},clear:function(){this.$events={}}},e}(),M=function(){var t=function(t){return t&&t.length>0},e=function(){var e=this.$$changes,n=this.$$observers;if(t(e)&&t(n)){var r=e.splice(0,e.length);o.forEach(n,function(t){t.callback.call(t.ctx,r)})}this.$asyncTask=null},n={observe:function(t,e){return this.$$observers=this.$$observers||[],this.$$observers.push({ctx:e||null,callback:t}),this},unobserve:function(e,n){if(t(this.$$observers))if(0===arguments.length)this.$$observers=[];else{var r=n||null;this.$$observers=o.reject(this.$$observers,function(t){return t.ctx===r&&e===t.callback})}return this},notify:function(t){return o.isArray(t)||(t=[t]),this.$$changes=this.$$changes||[],this.$$changes.push.apply(this.$$changes,t),this.$asyncTask&&clearTimeout(this.$asyncTask),this.$asyncTask=setTimeout(o.bind(e,this)),this},pendingChanges:function(){return this.$$changes||[]},clearChanges:function(){return this.$$changes&&(clearTimeout(this.$asyncTask),this.$$changes.splice(0,this.$$changes.length),this.$asyncTask=null),this}};return n}(),U=function(){var t=function(t,e,n,r,i){return{type:t,removed:e,index:r,addedCount:n.length,object:i,added:n}};return{createSplice:function(e,n,r,i){return t("splice",e,n,r,i)},createUpdate:function(e,n){return t("update",[],[],e,n)}}}(),H=function(){var t=function(t){return(null==t?"":t).toString()},e={$identity:o.identity,$empty:function(){return""},$lowercase:function(e){return t(e).toLowerCase()},$uppercase:function(e){return t(e).toUpperCase()},$capitalize:function(e){return B.capitalize(t(e))},$get:function(t){return e[t]}};return e}(),q=function(){var t=function(t){return null==t?"":String(t.toString())},e=function(t){return null==t?0:Number(t)||0},n=function(t){return"false"===t?0:Boolean(t)?1:0},r=function(t){var n=o.isDate(t)?t:new Date(e(t));return n.getTime()},i=function(t){return function(e,n){return t(e)-t(n)}},s={$string:function(e,n){return t(e).localeCompare(t(n))},$number:i(e),$boolean:i(n),$date:i(r),$auto:function(t,e){if(t===e||null==t&&null==e)return 0;var n=o.find(["Number","Boolean","Date","String"],function(n){var r=o["is"+n];return r(t)||r(e)});return n?s["$"+n.toLowerCase()](t,e):e>t?-1:1},$get:function(t){return s[t]}};return s}(),J=function(){var t=function(t){return null==t?"":t.toString()},e=function(e,n,r){var i=t(e),o=t(n);return r(i,o)},n=function(t,e){return t.toLowerCase().indexOf(e.toLowerCase())>=0},r=function(t,r){return e(t,r,n)},i=function(t){var e=function(n){return o.some(o.keys(n),function(i){var s=n[i];return o.isObject(s)?e(s):r(n[i],t)})};return e},s=function(t){var e=o.map(o.keys(t),function(e){return function(n){return r(h(e)(n),t[e])}});return function(t){return o.every(e,function(e){return e(t)})}};return{$create:function(t){if(o.isFunction(t))return t;var e=o.isObject(t)?s:i,n=e(t);return n.$predicate=t,n}}}(),V=function(){var t=Array.prototype,e=function(){try{var e={};return e[0]=1,!!t.toString.call(e)}catch(n){return!1}}(),r=function(n){return function(){var r=e?this:o.toArray(this);return t[n].apply(r,arguments)}},i=function(t,e,n){return r(t).apply(e,n)},u=function(t,e){var n=e||{};this.$$map=new a,this.$$model=n.model||Object,this.$$key=n.key||"id",o.isFunction(this.$$key)||(this.$$key=h(this.$$key)),this.length=0,t&&t.length&&this.push.apply(this,t)},c=function(t){return parseInt(Number(t)||0,10)},l=U.createSplice,f=U.createUpdate,d=function(t,e){delete t[e]},v=function(t,e){t.$$map.remove(e)},p=function(t,e){var n=t.$$key(e),r=t.$$map.get(n),i=r?r.idx:null;null!=i&&(d(t,i),v(t,n))},g=function(t){throw Error(t)},b=function(t,e){o.isObject(e)||g("Waffle collections are not array, only object are allowed");var n;n=e instanceof t.$$model?e:new t.$$model(e);var r=t.$$key(n);return null==r&&g("Collection elements must have an id, you probably missed to specify the id key on initialization ?"),n},m=function(t){return b(this,t)},$=function(t,e,n,r){if(t[n]=e,null!=e){var i=arguments.length,o=3===i?t.$$key(e):r,s=t.$$map.get(o)||{};s.idx=n,t.$$map.put(o,s)}return e},y=function(t,e,n){var r=t.at(n),i=t.at(e);$(t,i,n),$(t,r,e)},x=function(t,e,n){for(var r=Math.abs(n),i=t.length-1;i>=e;--i)y(t,i,i+r);t.length+=r},C=function(t,e,n){for(var r=Math.abs(n),i=t.length,o=i-r,s=e+r,a=[],u=s;i>u;++u)y(t,u,u-r);for(var c=o;i>c;++c){var h=t.at(c);a.unshift(h),p(t,h)}return t.length=o,a},w=function(t,e){for(var n,r=t.$$sortFn,i=t.length,s=e.length,a=i+s,u=[],c=i-1,h=s-1,f=a-1;f>=0;--f)if(0>c||r(t[c],e[h])<0){var d=$(t,e[h--],f);if(n=o.first(u),n&&n.index===f+1?(n.index=f,n.addedCount++,n.added.unshift(d)):(n=l([],[d],f,t),u.unshift(n)),0>h)break}else $(t,t[c--],f);return t.length=a,u},k=function(t,e,n){var r=t.length,i=t.$$sortFn,o=n>0?t[n-1]:null;if(null!=o&&i(o,e)>0)return!1;var s=r>n?t[n+1]:null;return null!=s&&i(e,s)>0?!1:!0};u.prototype={options:function(){return{model:this.$$model,key:this.$$key}},at:function(t){return this[t]},byKey:function(t){var e=this.indexOf(t);return e>=0?this.at(e):n},ctx:function(t){var e=o.isObject(t)?this.$$key(t):t;return this.$$map.contains(e)?this.$$map.get(e):null},indexOf:function(t){var e=this.ctx(t);return e?e.idx:-1},contains:function(t){return this.indexOf(t)>=0},findIndex:function(t,e){for(var n=0,r=this.length;r>n;++n)if(t.call(e,this.at(n),n,this))return n;return-1},replace:function(t){var e=b(this,t),n=this.indexOf(e);0>n&&g("Data to replace is not in collection !");var r=this.length,i=this.$$sortFn;return i&&r>1&&!k(this,e,n)?(this.remove(e),this.push(e)):(this[n]=e,this.notifyUpdate(n)),this},add:function(t,e){var n=null==e?this.length:e,r=[n,0].concat(t);return this.splice.apply(this,r),this.length},remove:function(t,e){if(o.isNumber(t))return this.splice.call(this,t,e||this.length);if(o.isArray(t)){var n=this.$$key,r=o.indexBy(t,function(t){return n(t)});return this.remove(function(t){return!!r[n(t)]})}if(o.isObject(t)&&!o.isFunction(t)){var i=b(this,t),s=this.indexOf(i);return s>=0?this.remove(s,1):[]}for(var a=t,u=e,c=0,h=null,f=[],p=[],g=0,m=this.length;m>g;++g){var y=this.at(g),x=this.$$key(y);a.call(u,y,g)?(d(this,g),v(this,x),h===g-1?o.last(f).removed.push(y):f.push(l([y],[],g,this)),p.push(y),h=g):(c!==g&&(d(this,g),v(this,x),$(this,y,c,x)),c++)}return this.length-=p.length,f.length>0&&this.notify(f),p},notifyUpdate:function(t){return this.notify([f(t,this)])},push:function(){return this.add.call(this,o.toArray(arguments))},unshift:function(){return this.add.call(this,o.toArray(arguments),0)},pop:function(){return this.remove(this.length-1,1)[0]},shift:function(){return this.remove(0,1)[0]},toggle:function(t){var e=this.indexOf(t);return e>=0?this.remove(e,1):this.push(t)},clear:function(){if(this.length>0){for(var t=[],e=0,n=this.length;n>e;++e)t[e]=this.at(e),d(this,e);this.$$map.clear(),this.length=0,this.notify(l(t,[],0,this))}return this},reset:function(t){var e=this.length,n=t.length,r=o.map(t,m,this),i=this.$$sortFn;i&&r.sort(i),this.$$map.clear();for(var s=[],a=0;n>a;++a)e>a&&s.push(this.at(a)),$(this,r[a],a);for(;e>a;++a)s.push(this.at(a)),d(this,a);return this.length=n,this.notify([l(s,r,0,this)]),this},isEmpty:function(){return 0===this.length},concat:function(){var e=t.concat.apply(this.toArray(),arguments);return new u(e,this.options())},slice:function(){var t=i("slice",this,arguments);return new u(t,this.options())},splice:function(t,e){var n=this.$$sortFn,r=this.length,i=o.rest(arguments,2),s=o.map(i,m,this),a=c(t);a=a>=0?Math.min(r,a):Math.max(r+a,0);var u=Math.min(Math.max(c(e)||0,0),r-a),h=[];if(u>0){for(var f=0;u>f;++f)h.push(this[f+a]);C(this,a,u)}var d,v=o.groupBy(s,this.contains,this),p=v[!0]||[],g=v[!1]||[],b=g.length,y=p.length;if(b>0)if(n)g.sort(n),d=w(this,g);else{x(this,a,b);for(var k=0;b>k;++k)$(this,g[k],a+k);d=[l(h,g,a,this)]}else d=[];if(h.length>0){var E=o.find(d,function(t){return t.index===a});E?E.removed=h:d.unshift(l(h,[],a,this))}if(d.length>0&&this.notify(d),y>0){n&&p.sort(n);for(var N=0;y>N;++N)this.replace(p[N])}return h},reverse:function(){if(this.$$sortFn)return this;for(var t=this.length,e=Math.floor(t/2),n=[],r=[],i=0,o=t-1;e>i;++i,--o)y(this,i,o),n.push(f(i,this)),r.unshift(f(o,this));var s=n.concat(r);return s.length&&this.notify(s),this},split:function(t){return B.split(this,t)},toJSON:function(){return s.toJson(this.toArray())},sort:function(t){return this.$$sortFn=t,this.reset(this.toArray()).clearChanges()},pluck:function(t){var e=h(t);return this.map(function(t){return e(t)})}},u.prototype.lastIndexOf=u.prototype.indexOf,o.extend(u.prototype,M);var E=["size","first","last","initial","rest","partition","forEach","map","every","some","reduce","reduceRight","filter","reject","find","toArray"];return o.forEach(E,function(t){o[t]&&(u.prototype[t]=function(){var e=[this].concat(o.toArray(arguments));return o[t].apply(o,e)})}),o.forEach(["countBy","groupBy","indexBy"],function(t){u.prototype[t]=function(e,n){if(o.isString(e)){var r=h(e);e=function(t){return r(t)}}return o[t].call(o,this,e,n)}}),o.forEach(["toString","toLocaleString","join"],function(t){u.prototype[t]=r(t)}),u}(),K=function(){var t={enable:!0,type:"text",css:null},e={".":"-","(":"",")":"","[":"-","]":"-","'":"",'"':""},n=o.isUndefined,r="$identity",i="$auto",s=B.resultWith,a=B.fromPx,u=B.toPx,c=function(t,e,n){return o.isString(t)&&(t=e.$get(t)),o.isFunction(t)||(t=e.$get(n)),t},f=function(s){o.isString(s)&&(s={id:s});var a=s.escape,u=s.sortable;this.id=s.id,this.title=s.title||"",this.field=s.field||this.id,this.css=s.css||"",this.escape=n(a)?!0:!!a,this.width=s.width,this.sortable=n(u)?!0:!!u,this.draggable=!!s.draggable,this.asc=null;var f=s.editable===!0?{}:s.editable;if(f&&(f=o.defaults(f,t)),this.editable=f,!this.css)for(var d=0,v=this.id.length;v>d;++d){var p=this.id.charAt(d),g=e[p];this.css+=null!=g?g:p}a&&(this.title=l(this.title));var b=s.renderer||r,m=o.isArray(b)?b:[b];this.$renderer=o.map(m,function(t){return c(t,H,r)}),this.$comparator=c(s.comparator,q,i),this.$parser=h(this.field)};return f.prototype={cssClasses:function(t,e,n){var r=n?[n]:[],i=s(this.css,this,r);o.isArray(i)&&(i=i.join(" "));var a=[i];this.sortable&&a.push(v),this.draggable&&a.push(b);var u=this.asc;return null!=u&&a.push(u?p:g),a.join(" ")},attributes:function(t,e){var n={};if(n[N]=this.id,e){if(this.sortable){n[S]=!0;var r=this.asc;null!=r&&(n[A]=r?T:O)}this.draggable&&(n.draggable=!0)}return n},styles:function(){var t={},e=u(this.computedWidth);return e&&(t.width=e,t.maxWidth=e,t.minWidth=e),t},updateWidth:function(t){return this.width=a(t),this},isEditable:function(t){return this.editable&&this.editable.enable?t?s(this.editable.enable,this,[t]):!0:!1},render:function(t){var e=this.field,n=this.value(t),r=o.reduce(this.$renderer,function(n,r){return r.call(H,n,t,e)},n);return null==r?"":this.escape?l(r):r},value:function(t,e){var n=this.$parser;return 2===arguments.length?(n.assign(t,e),this):null==t?"":n(t)}},f}(),_=function(){var t=function(t,n,r,i){var o=t.length-1;if(0>o||0>n||r>=n)return r;for(var s=Math.min(n,o),a=n;s>=0&&a>=n;){if(a=e.getDataIndex(t[s]),i(a,n))return s;s--}return r},e={getDataIndex:function(t){return Number(t.getAttribute(D))},getRowIndexForDataIndex:function(e,n){return t(e,n,-1,function(t,e){return t===e})},getPreviousRowIndexForDataIndex:function(e,n){return t(e,n-1,-1,function(t,e){return e>=t})},getCheckbox:function(t){return t.childNodes[0].childNodes[0]}};return e}(),G=function(){var t="THEAD",e="TFOOT",n="TBODY",r="TH",s="TR",a="INPUT",u="SELECT",c=function(t){return t.tagName===a&&"checkbox"===t.getAttribute("type")},h=function(t){var e=t.tagName,n=e===a||e===u;return n&&null!=t.getAttribute(N)},l=function(t){return!!t.getAttribute("draggable")},f=function(t,e){var n=W.findParent(t,e.tagName);return n===e},d={number:function(t){return Number(t)},checkbox:function(t){return!!t}},v={checkbox:"checked"},p=function(t,e){var n=t.target,i=W.findParent(t.target,r);if(n.tagName!==e)if(this.isSelectable()&&c(n))n.checked?this.select():this.deselect();else if(i&&i.getAttribute(S)){var s,a=i.getAttribute(N),u=i.getAttribute(A)||O,h=u===T?O:T,l=h+a;if(t.shiftKey){var f=u+a;s=o.reject(this.$comparators,function(t){return t.predicate()===f})}else s=[];s.push(l),this.sortBy(s)}},g={onClickThead:function(e){return p.call(this,e,t)},onClickTfoot:function(t){return p.call(this,t,e)},onClickTbody:function(t){if(this.isSelectable()){var e=t.target;if(e.tagName!==n&&!h(e)){var r=W.findParent(e,s),i=r.getAttribute(D),o=this.$data,a=o.at(i);if(this.isSelectable(a)){var u=this.$selection;if(this.options.selection.multi)if(t.shiftKey){for(var c=parseFloat(i),l=parseFloat(this.$$selectAnchor),f=Math.min(c,l),d=Math.max(c,l),v=[],p=f;d>=p;++p){var g=o.at(p);!u.contains(g)&&this.isSelectable(g)&&v.push(g)}v.length>0&&u.push.apply(u,v)}else u.toggle(a),this.$$selectAnchor=i;else{var b=u.indexOf(a);b>=0?u.remove(b,1):u.reset([a])}}}}},onInputTbody:function(t){var e=t.target,n=e.getAttribute(N),r=n?this.$columns.byKey(n):null;if(r&&r.isEditable()){var i=W.findParent(e,"TR");if(i){var s=r.editable.type,a=d[s]||o.identity,u=v[s]||"value",c=Number(i.getAttribute(D)),h=this.$data,l=h.at(c),f=r.value(l),p=a(e[u]);f!==p&&(r.value(l,p),this.dispatchEvent("datachanged",{index:c,object:l,field:n,oldValue:f,newValue:p}),h.replace(l))}}},onDragStart:function(t){var e=t.target,n=t.originalEvent||t,r=n.dataTransfer;l(e)&&(i(e).addClass(m),r.effectAllowed="move",r.clearData(),r.setData("Text",e.getAttribute(N)))},onDragEnd:function(t){var e=t.target,n=this.$table[0];i(W.byTagName("th",n)).removeClass($),l(e)&&f(e,n)&&i(t.target).removeClass(m)},onDragOver:function(t){var e=t.target;if(l(e)&&f(e,this.$table[0])){var n=t.originalEvent||t,r=n.dataTransfer;return r.dropEffect="move",t.preventDefault(),!1}},onDragEnter:function(t){var e=t.target;return l(e)&&f(e,this.$table[0])?(i(e).addClass($),t.preventDefault(),!1):void 0},onDragLeave:function(t){var e=t.target;return l(e)&&f(e,this.$table[0])?(i(e).removeClass($),t.preventDefault(),!1):void 0},onDragDrop:function(t){var e=t.target;if(l(e)&&f(e,this.$table[0])){var n=t.originalEvent||t,r=n.dataTransfer,o=r.getData("Text"),s=e.getAttribute(N);if(o!==s){var a=this.$columns,u=a.indexOf(o),c=a.indexOf(s);a.add(a.remove(u,1),c),i(e).removeClass($)}return t.preventDefault(),!1}},onSelectStart:function(t){var e=t.target;return l(e)?(t.preventDefault(),e.dragDrop(),!1):void 0}};return g}(),Y=function(){var e=function(t,e,n,r){var i=t["$"+e];i&&!t.$$events[r]&&(t.$$events[r]=o.bind(G[r],t),i.on(n,t.$$events[r]))},n=function(t,e,n,r){var i=t["$"+e];i&&t.$$events[r]&&(i.off(n,t.$$events[r]),t.$$events[r]=null)},r=function(){var t=u.hasEvent("input")?"input":"keyup";return t+=" change"},s="click",a=function(t,r,i){t["bind"+r]=function(t){i(t,e)},t["unbind"+r]=function(t){i(t,n)}},c={bindResize:function(e){if(!e.$$events.onResize){var n=o.bind(e.resize,e);e.$$events.onResize=o.debounce(n,100),e.$window=i(t),e.$window.on("resize",e.$$events.onResize)}},unbindResize:function(t){t.$$events.onResize&&(t.$window.off("resize",t.$$events.onResize),t.$window=null)}};return a(c,"Edition",function(t,e){e(t,F,r(),"onInputTbody")}),a(c,"Selection",function(t,e){e(t,z,s,"onClickThead"),e(t,j,s,"onClickTfoot"),e(t,F,s,"onClickTbody")}),a(c,"Sort",function(t,e){e(t,z,s,"onClickThead"),e(t,j,s,"onClickTfoot")}),a(c,"DragDrop",function(t,e){e(t,R,"dragstart","onDragStart"),e(t,R,"dragover","onDragOver"),e(t,R,"dragend","onDragEnd"),e(t,R,"dragleave","onDragLeave"),e(t,R,"dragenter","onDragEnter"),e(t,R,"drop","onDragDrop"),B.msie()<=9&&e(t,R,"selectstart","onSelectStart")}),c}(),Q=function(){var t="px",e="percent",n="auto",r={};r[t]=function(t){return B.fromPx(t.computedWidth)},r[e]=function(t,e){return B.fromPercentage(t.computedWidth)*e/100},r[n]=function(t,e,n){return e/n};var i={checkbox:function(t){return!!t}},s=function(t,e){var n=t.$selection.size(),r=W.span({title:n},""+n),i=t.isSelected(),o=W.inputCheckbox({checked:i,indeterminate:!i&&n>0}),s=e?[r,o]:[o,r],a={className:w};return W.th(a,s)},a={computeWidth:function(i,s){var a=i,u=0,c=s.groupBy(function(r){var i=r.computedWidth=o.result(r,"width");return o.isNumber(i)||B.isPx(i)?t:B.isPercentage(i)?e:n});o.forEach([t,e,n],function(t){var e=c[t];if(e){var n=a,i=e.length;o.forEach(e,function(e){var o=r[t](e,n,i);e.computedWidth=o,a-=o,u++})}})},theadRow:function(t){var e=[];return t.hasCheckbox()&&e.push(a.theadCheckboxCell(t)),t.$columns.forEach(function(n,r){e.push(a.theadCell(t,n,r))}),W.tr(null,e)},theadCell:function(t,e,n){var r=e.attributes(n,!0);return r.className=e.cssClasses(n,!0),r.style=e.styles(n,!0),W.th(r,e.title)},theadCheckboxCell:function(t){return s(t,!0)},tfootRow:function(t){var e=[];return t.hasCheckbox()&&e.push(a.tfootCheckboxCell(t)),t.$columns.forEach(function(n,r){e.push(a.tfootCell(t,n,r))}),W.tr(null,e)},tfootCell:function(t,e,n){return a.theadCell(t,e,n)},tfootCheckboxCell:function(t){return s(t,!1)},tbodyRows:function(t,e,n){for(var r=W.createFragment(),i=0,o=e.length;o>i;++i)r.appendChild(a.tbodyRow(t,e[i],n+i));return r},tbodyRow:function(t,e,n){var r={};r[D]=n,r[N]=t.$data.$$key(e),r[E]=o.uniqueId();var i=[],s="";return t.isSelectable()&&(t.isSelectable(e)&&(s+=x),t.$selection.contains(e)&&(s+=" "+C),t.hasCheckbox()&&i.push(a.tbodyCheckboxCell(t,e))),s&&(r.className=s),t.$columns.forEach(function(n,r){i.push(a.tbodyCell(t,e,n,r))}),W.tr(r,i)},tbodyCell:function(t,e,n,r){var i=n.attributes(r,!1);i.className=n.cssClasses(r,!1,e),i.style=n.styles(r,!1);var o=n.isEditable(e)?a.tbodyControl(n,e):n.render(e);return W.td(i,o)},tbodyCheckboxCell:function(t,e){var n={className:w},r=t.isSelectable(e)?W.inputCheckbox({checked:t.isSelected(e)}):null;return W.td(n,r)},tbodyControl:function(t,e){var n,r=t.editable,s=null,a={};"select"===r.type?(n="select",r.options&&(s=o.map(r.options,function(t){var e=null!=t.value?{value:t.value}:null,n=null!=t.label?t.label:"";return W.option(e,n)}))):(n="input",a.type=r.type),a[N]=t.id;var u="checkbox"===r.type?"checked":"value",c=i[r.type]||o.identity;return a[u]=c(t.value(e)),r.css&&(a.className=r.css),W[n](a,s)}};return a}(),X=function(){var t="px",e="percent",n="auto",r={};r[t]=function(t){return B.fromPx(t)},r[e]=function(t,e){return B.fromPercentage(t)*e/100},r[n]=function(t,e,n){return e/n};var i={resize:function(t){i.applySize(t)},applySize:function(t){var e=t.options.size,r=o.result(e,"width"),s=o.result(e,"height"),a=r&&r!==n,u=s&&s!==n;if(a){var c=B.toPx(r);t.$table.css({width:c,maxWidth:c,minWidth:c})}if(u){var h=B.toPx(s);t.$tbody.css({maxHeight:h})}var l=a?B.fromPx(r):null;l||(l=t.$table[0].offsetWidth),l-=W.scrollbarWidth(),t.hasCheckbox()&&(l-=30);var f=t.$columns,d=i.computeWidth(l,f);if(d.length>0)for(var v=o.indexBy(f.pendingChanges(),function(t){
return t.type+"_"+t.index}),p=0,g=d.length;g>p;++p){var b=f.indexOf(d[p]);o.has(v,"update_"+b)||f.notifyUpdate(b)}return this},computeWidth:function(i,s){var u=i,c=0,h=new a,l=s.groupBy(function(r){var i=o.result(r,"width");return h.put(r.id,i),o.isNumber(i)||B.isPx(i)?t:B.isPercentage(i)?e:n}),f=[];return o.forEach([t,e,n],function(t){var e=l[t];if(e){var n=u,i=e.length;o.forEach(e,function(e){var o=r[t](h.get(e.id),n,i);o!==e.computedWidth&&(e.computedWidth=o,f.push(e)),u-=o,c++})}}),f}};return i}(),Z=function(){var t=_.getDataIndex,e=_.getPreviousRowIndexForDataIndex,n=_.getRowIndexForDataIndex,r={on:function(t){return o.forEach(t,function(t){var e="on"+B.capitalize(t.type);r[e].call(this,t)},this),this},onSplice:function(n){var r,s,a=this.$tbody,u=a[0],c=u.childNodes,h=n.index,l=n.addedCount,f=n.object,d=n.added,v=n.removed,p=e(c,h)+1,g=v.length;if(g>0){var b=0===h&&f.length-l===0;if(b)r=o.toArray(c),a.empty();else{r=[];for(var m=c[p],$=0;g>$&&m;++$){var y=h+$,x=t(m);x===y&&(r.push(u.removeChild(m)),m=c[p])}}var C=this.$selection;C&&C.length>0&&C.remove(v)}if(l>0){s=[];for(var w=W.createFragment(),k=this.$filter||o.constant(!0),E=0;l>E;++E){var N=E+h,S=d[E],A=f.ctx(S);if(A.visible=k(S),A.visible){var T=Q.tbodyRow(this,S,N);s.push(T),w.appendChild(T)}}s.length>0&&(p>0?i(c[p-1]).after(w):a.prepend(w))}if(r||s){for(var O=l-g,F=h+o.size(s),z=c.length;z>F;++F){var j=c[F],R=t(j);j.setAttribute(D,R+O)}this.dispatchEvent("dataspliced",{added:d||[],addedNodes:s||[],removedNodes:r||[],removed:v,index:h,nodeIndex:p})}return this},onUpdate:function(t){var e=t.index,r=this.$data.at(e),i=this.$tbody[0],o=i.childNodes,s=n(o,e);if(s>=0){var a=o[s],u=Q.tbodyRow(this,r,e),c=a.getAttribute(E);I.mergeNodes(i,a,u),a.setAttribute(E,c),this.dispatchEvent("dataupdated",{index:e,nodeIndex:s,node:a})}return this}};return r}(),tt=function(){var t=function(t){return t.getAttribute(N)},e=function(e,n){for(var r=[],i=e.childNodes,s=0,a=i.length;a>s;++s)for(var u=i[s],c=o.indexBy(u.childNodes,t),h=0,l=n.length;l>h;++h){var f=c[n[h].id];f&&r.push(u.removeChild(f))}return r},n=function(t,e,n){return t.insertBefore(e,t.childNodes[n]||null)},r={tbody:function(t,e,n){return Q.tbodyCell(this,this.$data.at(n),t,e)},thead:function(t,e){return Q.theadCell(this,t,e)},tfoot:function(t,e){return Q.tfootCell(this,t,e)}},i=function(t,e,n){return function(i,o){var s=i.childNodes[n],a=r[t].call(this,e,n,o),u=I.mergeNodes(i,s,a);return{oldNode:s,newNode:u}}},s=function(t,e){e.draggable=!!e.draggable||!!t.isDraggable(),t.isSortable()||(e.sortable=!1)},a={on:function(t){return o.forEach(t,function(t){var e="on"+B.capitalize(t.type);a[e].call(this,t)},this),this},onSplice:function(r){var i,a,u,c,h,l=this.$tbody[0],f=this.hasHeader()?this.$thead[0]:null,d=this.hasFooter()?this.$tfoot[0]:null,v=this.hasCheckbox(),p=r.index,g=r.added,b=r.addedCount,m=r.removed,$=[],y=[],x=[],C=this.$data,w=this.$columns,k=m.length,E=k>0||b>0;E&&this.isResizable()&&this.resize(),k>0&&(y.push.apply(y,e(l,m)),f&&$.push.apply($,e(f,m)),d&&x.push.apply(x,e(d,m)));var S=[],A=[],D=[];if(b>0){for(i=0;b>i;++i){u=p+i;var T=g[i];if(s(this,T),f){var O=Q.theadCell(this,T,u);c=f.childNodes[0],S.push(n(c,O,v?u+1:u))}if(d){var F=Q.tfootCell(this,T,u);c=d.childNodes[0],D.push(n(c,F,v?u+1:u))}}for(a=0,h=l.childNodes.length;h>a;++a){c=l.childNodes[a];var z=o.indexBy(c.childNodes,t),j=c.getAttribute(N),R=C.byKey(j);for(i=0;b>i;++i){u=p+i;var B=g[i],W=B.id;z[W]&&c.removeChild(z[W]);var I=Q.tbodyCell(this,R,w.at(u),u);A.push(n(c,I,v?u+1:u))}}}if(E){var P=this.isEditable();b>0&&P?Y.bindEdition(this):k>0&&!P&&Y.unbindEdition(this),this.dispatchEvent("columnsspliced",{index:p,removedNodes:{thead:$,tbody:y,tfoot:x},addedNodes:{thead:S,tbody:A,tfoot:D}})}return this},onUpdate:function(t){var e=t.index,n=this.hasCheckbox()?e+1:e,r=this.$columns.at(e);s(this,r);var a=function(t){var e=[[],[]],s=this["$"+t];if(s){var a=s[0].childNodes,u=i.call(this,t,r,n),c=function(t,e,n){var r=u.call(this,e,n);return t[0].push(r.oldNode),t[1].push(r.newNode),t};e=o.reduce(a,c,e,this)}return e},u=o.map([z,j,F],a,this);return r.editable?Y.bindEdition(this):this.isEditable()||Y.unbindEdition(this),this.dispatchEvent("columnsupdated",{index:e,oldNodes:{thead:u[0][0],tfoot:u[1][0],tbody:u[2][0]},newNodes:{thead:u[0][1],tfoot:u[1][1],tbody:u[2][1]}}),this}};return a}(),et=function(){var t=_.getRowIndexForDataIndex,e=_.getCheckbox,n=function(t,e){t.checked=e},r={on:function(t){return o.forEach(t,function(t){var e="on"+B.capitalize(t.type),n=r[e];n&&n.call(this,t)},this),this},onSplice:function(r){var o,s,a,u,c=this.$tbody,h=this.$data,l=r.object,f=c[0],d=f.childNodes,v=r.added,p=r.removed,g=r.addedCount,b=p.length;if(b>0)for(var m=0;b>m;++m)o=h.indexOf(p[m]),o>=0&&(a=t(d,o),s=d[a],s&&(i(s).removeClass(C),this.hasCheckbox()&&(u=e(s),u&&n(u,!1))));if(g>0)for(var $=0;g>$;++$)o=h.indexOf(v[$]),a=t(d,o),s=d[a],s&&(i(s).addClass(C),this.hasCheckbox()&&(u=e(s),u&&n(u,!0)));if(g>0||b>0){var y=g-b;if(y&&this.hasCheckbox()){var x=l.length,w=this.isSelected(),k=x>0&&h.length!==x,E=this.hasHeader()?this.$thead[0]:null,N=this.hasFooter()?this.$tfoot[0]:null;if(E){var S=E.childNodes[0].childNodes[0],A=S.childNodes[0],D=S.childNodes[1];A.innerHTML=A.title=x,D.checked=w,D.indeterminate=k}if(N){var T=N.childNodes[0].childNodes[0],O=T.childNodes[1],F=T.childNodes[0];O.innerHTML=O.title=x,F.checked=w,F.indeterminate=k}}this.dispatchEvent("selectionchanged",function(){return{selection:this.$selection.toArray()}})}return this}};return r}(),nt=function(){var t={applyFilter:function(t){var e=null==t?o.constant(!0):t,n=function(t,n,r){var i=this.$tbody[0],s=i.childNodes,a=this.$data.ctx(n),u=o.isUndefined(a.visible)?!0:!!a.visible,c=!!e(n),h=0,l=null;if(a.visible=c,u!==c){var f=s[a.idx-t.nbFiltered];if(c){var d=Q.tbodyRow(this,n,r);i.insertBefore(d,f)}else l=i.removeChild(f),h++}else c||h++;return t.nbFiltered+=h,l&&t.removed.push(l),t},r={nbFiltered:0,removed:[]},i=this.$data.reduce(n,r,this),s=i.nbFiltered,a=i.removed;this.dispatchEvent("filterupdated",{predicate:t,countVisible:this.$data.size()-s,countFiltered:s,removedNodes:a})}};return t}(),rt=function(){var t=function(t){return function(){throw"Function "+t+" must be implemented"}},e=function(){};return e.prototype={compare:t("compare"),equals:function(t){return this.predicate()===t.predicate()},predicate:function(){return this.id}},e}(),it=function(){var t=function(t,e){var n=e.charAt(0),r=n===T||n===O?e.slice(1):e,i=t.$columns.byKey(r);this.id=r,this.asc=n!==O;var o,s;i&&(o=i.$parser,s=i.$comparator),this.parser=o||h(r),this.comparator=s||q.$auto},e=t.prototype=new rt;return e.compare=function(t,e){if(t===e)return 0;var n=this.parser(t),r=this.parser(e),i=this.comparator(n,r);return this.asc?i:-1*i},e.predicate=function(){var t=this.asc?T:O;return t+this.id},e.equals=function(t){return this.id===t.id&&this.asc===t.asc&&this.comparator===t.comparator},t.of=function(e,n){return n instanceof t?n:new t(e,n)},t}(),ot=function(){var t=function(t,e){this.id=o.uniqueId(),this.comparator=e},e=t.prototype=new rt;return e.compare=function(t,e){return t===e?0:this.comparator(t,e)},t.of=function(e,n){return n instanceof t?n:new t(e,n)},t}(),st=function(){var t=function(t,e){this.id=o.uniqueId(),this.parser=e},e=t.prototype=new rt;return e.compare=function(t,e){if(t===e)return 0;var n=this.parser(t),r=this.parser(e);return q.$auto(n,r)},t.of=function(e,n){return n instanceof t?n:new t(e,n)},t}(),at=function(){var t=function(t,e){if(t===e||null==t&&null==e)return 0;for(var n=this.$comparators,r=0,i=n.length;i>r;++r){var o=n[r],s=o.compare(t,e);if(s)return s}var a=this.$data;return a.indexOf(t)-a.indexOf(e)},e=function(t,e){if(e instanceof rt)return e;if(o.isString(e))return it.of(t,e);if(o.isFunction(e)){var n=e.length;return 1>=n?st.of(t,e):ot.of(t,e)}throw"Cannot create comparator from object: "+e};return{of:function(t,n){return o.isArray(n)||(n=[n]),o.map(n,function(n){var r=e(t,n),i=t.$columns.byKey(r.id);return i&&(i.asc=r.asc),r})},equals:function(t,e){return t===e?!0:t.length!==e.length?!1:o.every(t,function(t,n){return t.equals(e[n])})},createComparator:function(e){return o.bind(t,e)}}}(),ut=function(){var t=B.resultWith,e=function(t){var e="$"+t,n=this.$table;this[e]=i(W.byTagName(t,n[0])),this[e].length||(this[e]=i(W[t]())),n.append(this[e][0])},r=function(t){var e=this.options.events[t];e&&this.addEventListener(t.slice(2),this.options.events[t])},s=function(t,e){if(!(this instanceof s))return new s(t,e);0!==arguments.length&&(o.isElement(t)||t instanceof i)||(e=t,t=null);var n=t?i(t)[0]:null,a=this.options=e=e||{},u=s.options;o.forEach(o.keys(u),function(t){var e=a[t],r=u[t];if(o.isUndefined(e)&&n){var i=B.toSpinalCase(t),s=n.getAttribute("data-waffle-"+i)||n.getAttribute("waffle-"+i)||n.getAttribute("data-"+i)||n.getAttribute(i);s&&(e=a[t]=B.parse(s))}o.isObject(r)&&(o.isObject(e)||o.isUndefined(e))&&(e=a[t]=o.defaults(e||{},r)),o.isUndefined(e)&&(e=a[t]=r)}),a.size={width:a.size.width,height:a.size.height},a.scrollable=a.scrollable||!!a.size.height;var c=this.isSortable(),h=this.isDraggable();!a.columns||c&&!h||o.forEach(a.columns,function(t){c||(t.sortable=!1),h&&(t.draggable=null==t.draggable?!0:!!t.draggable)}),this.$data=new V(a.data,{key:a.key,model:a.model}),this.$columns=new V(a.columns,{key:"id",model:K}),this.$selection=new V([],this.$data.options()),this.$comparators=new V([],{key:function(t){return t.id}}),this.$bus=new L,o.forEach(o.keys(a.events),r,this),this.sortBy(e.sortBy,!1),n&&this.attach(n),this.dispatchEvent("initialized")};s.create=function(t,e){return new s(t,e)},s.prototype={attach:function(t){this.$table&&this.detach();var n=this.$table=i(t),r=this.isSortable(),s=this.isDraggable(),a=this.isSelectable(),u=this.isEditable();n.addClass(this.cssClasses().join(" "));var c=[F];return this.hasHeader()&&c.unshift(z),this.hasFooter()&&c.push(j),o.forEach(c,e,this),this.$data.observe(Z.on,this),this.$columns.observe(tt.on,this),this.$selection.observe(et.on,this),this.$$events={},r&&Y.bindSort(this),u&&Y.bindEdition(this),a&&Y.bindSelection(this),this.isResizable()&&(this.resize(),Y.bindResize(this)),this.render(),this.clearChanges(),s&&Y.bindDragDrop(this),this.dispatchEvent("attached"),this},detach:function(){var t=this.$table;return t&&(t.removeClass(this.cssClasses().join(" ")),Y.unbindSort(this),Y.unbindEdition(this),Y.unbindSelection(this),Y.unbindResize(this),Y.unbindDragDrop(this),this.clearChanges(),this.$data.unobserve(Z.on,this),this.$columns.unobserve(tt.on,this),this.$selection.unobserve(et.on,this),this.dispatchEvent("detached"),this.$table=this.$tbody=this.$thead=this.$tfoot=null),this},cssClasses:function(){var t=[d];return this.isSelectable()&&t.push(x),this.isScrollable()&&t.push(y),t},rows:function(){return o.toArray(this.$tbody[0].childNodes)},data:function(){return this.$data},columns:function(){return this.$columns},selection:function(){return this.$selection},isEditable:function(){return this.options.editable||this.$columns.some(function(t){return t.isEditable()})},isSortable:function(){return this.options.sortable},isSelectable:function(e){var n=this.options.selection;return n&&n.enable?e?t(n.enable,this,[e]):!0:!1},isResizable:function(){var t=this.options.size;return!!t.height||!!t.width},isScrollable:function(){return this.options.scrollable},hasCheckbox:function(){return this.isSelectable()&&this.options.selection.checkbox},hasHeader:function(){return this.options.view.thead},hasFooter:function(){return this.options.view.tfoot},isSelected:function(t){if(!this.isSelectable())return!1;if(t)return this.$selection.contains(t);var e=this.$selection.length;if(0===e)return!1;var n=this.$data.length;return o.isFunction(this.options.selection.enable)&&(n=this.$data.filter(this.isSelectable,this).length),e>=n},isDraggable:function(){return!!this.options.dnd},isVisible:function(t){var e=this.$data.ctx(t);return e&&e.visible!==!1},visibleData:function(){var t=this.$data,e=this.$filter;return null!=e?t.filter(this.isVisible,this):t.toArray()},render:function(t){return this.renderHeader().renderFooter().renderBody(t).clearChanges()},renderHeader:function(){if(this.hasHeader()){var t=Q.theadRow(this);this.$thead.empty().append(t)}return this},renderFooter:function(){if(this.hasFooter()){var t=Q.tfootRow(this);this.$tfoot.empty().append(t)}return this},renderBody:function(t){var e=null==t?this.options.async:t,n=this,r=this.rows(),i=o.once(function(){n.$tbody.empty()}),s=function(t,e){var r=Q.tbodyRows(n,t,e);i(),n.$tbody.append(r)},a=function(){n.$data.clearChanges(),n.dispatchEvent("rendered",{data:n.data(),removedNodes:r,addedNodes:n.rows()}),n=i=s=a=r=null},u=null==this.$filter?this.$data:this.visibleData();return e?B.asyncTask(B.split(u,200),10,s,a):(s(u,0),a()),this},resize:function(){return X.resize(this),this},select:function(){return this.$selection.length!==this.$data.length&&this.$selection.add(this.$data.filter(this.isSelectable,this)),this},deselect:function(){return this.$selection.isEmpty()||this.$selection.clear(),this},sortBy:function(t,e){var n=null!=t?at.of(this,t):[];if(at.equals(this.$comparators,n))return this;if(this.$comparators.reset(n),this.$data.sort(at.createComparator(this)),this.$table){var r=this.hasHeader(),i=this.hasFooter(),s=r?this.$thead.children().eq(0).children():null,a=i?this.$tfoot.children().eq(0).children():null,u=function(t){t.removeClass(p+" "+g).removeAttr(A)},c=function(t,e,n){var r=n?T:O;t.eq(e).addClass(n?p:g).attr(A,r)};s&&u(s),a&&u(a);var h=this.$columns,l=this.hasCheckbox();o.forEach(this.$comparators,function(t){var e=t.id,n=t.asc,r=h.indexOf(e),i=l?r+1:r;r>=0&&(s&&c(s,i,n),a&&c(a,i,n))})}return e!==!1&&this.renderBody(),this.dispatchEvent("sorted")},filter:function(t){var e=null==t||""===t,r=e?n:t,i=this.$filter,o=i?i.$predicate:null,s=null==o||o!==r;return s&&(this.$filter=null==r?n:J.$create(r),nt.applyFilter.call(this,this.$filter)),this},removeFilter:function(){return null!=this.$filter&&this.filter(n),this},dispatchEvent:function(t,e){return this.$bus.dispatchEvent(this,t,e),this.$bus.dispatchEvent(this,"updated"),this},addEventListener:function(t,e){return this.$bus.addEventListener(t,e),this},removeEventListener:function(t,e){return this.$bus.removeEventListener(t,e),this},clearChanges:function(){return this.$data.clearChanges(),this.$columns.clearChanges(),this.$selection&&this.$selection.clearChanges(),this},destroy:function(){this.detach(),this.$bus.clear(),this.$$events=null,B.destroy(this)}},s.options={key:"id",data:null,columns:null,sortBy:null,async:!1,scrollable:!1,sortable:!0,editable:!1,dnd:!1,selection:{enable:!0,checkbox:!0,multi:!1},view:{thead:!0,tfoot:!1},size:{width:null,height:null},events:{}};var a=["onInitialized","onUpdated","onRendered","onDataSpliced","onDataChanged","onDataUpdated","onColumnsSpliced","onColumnsUpdated","onSelectionChanged","onFilterUpdated","onSorted","onAttached","onDetached"];return o.forEach(a,function(t){s.options.events[t]=null}),s}(),ct={Grid:ut,options:ut.options,create:ut.create,addRenderer:function(t,e){return H[t]=e,ct},addComparator:function(t,e){return q[t]=e,ct}},ht={getDefaultProps:function(){return{waffle:o.clone(ct.options)}},componentWillMount:function(){this.grid=ct.create(this.props.waffle)},componentDidMount:function(){this.grid.attach(this.getDOMNode())},componentWillUnmount:function(){this.grid.destroy()},shouldComponentUpdate:function(){return!1},componentDidUpdate:function(){this.grid.render()},getGrid:function(){return this.grid}},lt=r.createClass({displayName:"Waffle",mixins:[ht],render:function(){var t=W.create;W.create=r.createElement;var e=this.grid,n=[];n.push(r.DOM.tbody(null,o.map(this.grid.visibleData(),function(t,n){return Q.tbodyRow(e,t,n)}))),e.hasHeader()&&n.unshift(r.DOM.thead(null,Q.theadRow(e))),e.hasFooter()&&n.push(r.DOM.tfoot(null,Q.tfootRow(e)));var i=o.clone(this.props),s=i.className||"";o.isArray(s)&&(s=s.join(" ")),s+=" "+this.grid.cssClasses().join(" "),i.className=s;var a=r.DOM.table(i,n);return W.create=t,a}});return lt})}(window,document,void 0);